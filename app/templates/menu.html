{% extends "base.html" %}

{% block title %}Menu ¬∑ Yorkie Bakery{% endblock %}

{% block content %}
<h1>üçΩÔ∏è Our Menu</h1>

{% set cart = request.session.get("cart", {}) %}

{# Group items by category #}
{% set categories = items | map(attribute='category') | unique | list %}

{% for cat in categories %}
  <h2 class="category-header">{{ cat }}</h2>

  <div class="menu-grid">
    {% for item in items if item.category == cat %}
    <div class="menu-card">

      <!-- Image -->
      {% if item.image_url %}
        <img src="{{ item.image_url }}" alt="{{ item.title }}">
      {% else %}
        <img src="/static/images/default_menu_image.jpg" alt="No Image Available">
      {% endif %}

      <!-- Title + Desc -->
      <h2>{{ item.title }}</h2>
      <p>{{ item.description }}</p>

      <!-- Metadata row -->
      <div class="menu-meta">

        {% if item.origin %}
        <p><strong>Origin:</strong> {{ item.origin }}</p>
        {% endif %}

        {% if item.tags %}
        <p><strong>Tags:</strong> {{ item.tags | join(", ") }}</p>
        {% endif %}

        {% if item.flavor_profile %}
        <p><strong>Flavor:</strong> {{ item.flavor_profile | join(", ") }}</p>
        {% endif %}

        {% if item.dietary_restrictions %}
        <p><strong>Dietary:</strong> {{ item.dietary_restrictions | join(", ") }}</p>
        {% endif %}

      </div>

      <!-- Price -->
      {% if item.price is not none %}
        <p class="price">${{ "%.2f"|format(item.price) }}</p>
      {% else %}
        <p class="price text-gray-400 italic">Price not set</p>
      {% endif %}

      <!-- Quantity in session -->
      {% set qty = cart.get(item.id|string, 0) %}

      {% if qty > 0 %}
        <span class="item-qty-badge">{{ qty }}</span>
      {% endif %}

      {% if qty == 0 %}
        <form action="/cart/add/{{ item.id }}" method="post">
          <button type="submit" class="btn">Add to Cart üõçÔ∏è</button>
        </form>
      {% else %}
        <div class="qty-controls">

          <form action="/cart/remove/{{ item.id }}" method="post" style="display:inline;">
            <button type="submit" class="qty-btn">‚àí</button>
          </form>

          <span class="qty-display">{{ qty }}</span>

          <form action="/cart/add/{{ item.id }}" method="post" style="display:inline;">
            <button type="submit" class="qty-btn">+</button>
          </form>

        </div>
      {% endif %}

    </div>
    {% endfor %}
  </div>

{% endfor %}

{% endblock %}