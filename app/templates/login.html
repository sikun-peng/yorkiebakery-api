{% extends "base.html" %}

{% block title %}Login - Yorkie Bakery{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h1>Login to Continue</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            Please login to complete your checkout
        </p>

        <form method="POST" action="/auth/login_form">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required placeholder="Your email">
            </div>

            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required placeholder="Your password">
            </div>

            <button type="submit" class="btn btn-primary">Login</button>
        </form>

        <div style="text-align: center; margin: 20px 0;">
            <span style="color: #666;">or</span>
        </div>

        <!-- Social Login Buttons -->
        <button onclick="location.href='/auth/login/google'" class="social-btn google-btn" style="width: 100%; margin-bottom: 10px;">
            Continue with Google
        </button>
        <button onclick="location.href='/auth/login/facebook'" class="social-btn facebook-btn" style="width: 100%;">
            Continue with Facebook
        </button>

        <div class="back-link" style="margin-top: 20px;">
            <a href="/auth/register">Don't have an account? Register</a>
        </div>

        <div style="text-align: center; margin-top: 15px;">
            <a href="#" onclick="showForgotPassword()" style="font-size: 14px; color: #666; text-decoration: none;">Forgot Password?</a>
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgot-password-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 400px;">
        <h3 style="margin-top: 0;">Reset Password</h3>
        <p>Enter your email to receive a password reset link:</p>
        <input type="email" id="forgot-email" placeholder="Your email" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px;">
        <div style="display: flex; gap: 10px;">
            <button onclick="sendResetLink()" class="btn btn-primary" style="flex: 1;">Send Reset Link</button>
            <button onclick="hideForgotPassword()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
        </div>
        <div id="reset-status" style="margin-top: 10px; font-size: 14px;"></div>
    </div>
</div>

<script>
function showForgotPassword() {
    document.getElementById('forgot-password-modal').style.display = 'block';
}

function hideForgotPassword() {
    document.getElementById('forgot-password-modal').style.display = 'none';
    document.getElementById('reset-status').textContent = '';
}

async function sendResetLink() {
    const email = document.getElementById('forgot-email').value;
    const statusEl = document.getElementById('reset-status');

    if (!email) {
        statusEl.textContent = 'Please enter your email';
        statusEl.style.color = 'red';
        return;
    }

    try {
        const response = await fetch('/auth/forgot_password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        });

        const result = await response.json();

        if (result.success) {
            statusEl.textContent = result.message;
            statusEl.style.color = 'green';
            setTimeout(() => {
                hideForgotPassword();
            }, 3000);
        } else {
            statusEl.textContent = result.error || 'Failed to send reset link';
            statusEl.style.color = 'red';
        }
    } catch (error) {
        statusEl.textContent = 'Error sending reset link';
        statusEl.style.color = 'red';
    }
}

// Close modal when clicking outside
document.getElementById('forgot-password-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideForgotPassword();
    }
});
</script>
{% endblock %}