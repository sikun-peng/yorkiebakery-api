{% extends "base.html" %}

{% block title %}System Architecture â€“ Yorkie Bakery AI{% endblock %}

{% block content %}

<section style="padding: 40px; max-width: 900px; margin: auto;">

  <h1 class="text-3xl font-bold text-center mb-6">ğŸ—ï¸ Yorkie Bakery â€“ System Architecture Overview</h1>

  <p class="text-gray-700 text-lg mb-8 text-center">
    This page provides a technical high-level overview (HLD) of the Yorkie Bakery platform,
    including backend architecture, AI/ML pipeline, database design, and deployment infrastructure.
    This is intended for recruiters and engineers evaluating my work.
  </p>

    <div style="text-align:center; margin: 30px 0;">
      <a
        href="https://github.com/sikun-peng/yorkiebakery-api/blob/main/HLD.md"
        target="_blank"
        class="btn"
        style="padding: 10px 20px; background:#ffe8b3; border-radius:8px; text-decoration:none; color:#6b4f2f; font-weight:bold;"
      >
        ğŸ“„ View Full System Design (HLD) on GitHub
      </a>
    </div>

  <!-- =========================== -->
  <!-- SECTION 1: High Level Diagram -->
  <!-- =========================== -->

  <h2 class="section-title">1. High-Level Architecture Diagram</h2>

  <pre class="architecture-diagram">
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚      React + Vite      â”‚
                â”‚  (AI Demo Frontend)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚  REST + JSON
                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚       FastAPI        â”‚
                  â”‚  Auth / Menu / AI    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼             â–¼         â–¼          â–¼               â–¼
PostgreSQL     ChromaDB   OpenAI    AWS S3 (Music)   AWS SES
(Menu/Users)   Vectors    Vision /   Audio Store    Email Verify
                         Embedding
  </pre>

  <!-- =========================== -->
  <!-- SECTION 2: Backend Design -->
  <!-- =========================== -->

  <h2 class="section-title">2. Backend Architecture (FastAPI)</h2>

  <p>
    The backend is a modular FastAPI application deployed on AWS EC2 using Docker Compose.
    It includes:
  </p>

  <ul class="bullet-list">
    <li>ğŸ”¹ **User authentication** (register, login, session cookies, email verification)</li>
    <li>ğŸ”¹ **Menu management** (admin CRUD, S3 image uploads)</li>
    <li>ğŸ”¹ **Music streaming** (S3 signed URLs)</li>
    <li>ğŸ”¹ **AI endpoints** for RAG, filters, and image matching</li>
  </ul>

  <h3>API Modules</h3>
  <ul class="bullet-list">
    <li><code>auth/</code> â€“ login, register, session, email verification</li>
    <li><code>menu/</code> â€“ product CRUD, pagination, filters</li>
    <li><code>ai/demo/</code> â€“ AI pipeline (LLM filters + vector search)</li>
    <li><code>ai/vision/</code> â€“ image upload â†’ OpenAI Vision model</li>
  </ul>

  <!-- =========================== -->
  <!-- SECTION 3: AI Pipeline -->
  <!-- =========================== -->

  <h2 class="section-title">3. AI Menu Recommendation Pipeline</h2>

  <p>
    The AI system uses a two-stage hybrid retrieval approach combining LLM semantic understanding
    with vector similarity search and strict backend filtering.
  </p>

  <h3>Pipeline Steps</h3>
  <ol class="number-list">
    <li>**User sends text or image** from the React demo.</li>
    <li>FastAPI calls **OpenAI** to extract:
      <ul>
        <li>category (pastry / dessert / drink)</li>
        <li>origin (japanese / french / thai / â€¦)</li>
        <li>flavor profile (sweet, fruity, chewy, creamy)</li>
        <li>price range</li>
      </ul>
    </li>
    <li>Use **ChromaDB vector store** to retrieve the top 50 candidate menu items.</li>
    <li>Apply **server-side filtering** with `apply_all_filters()`.</li>
    <li>Rank + return the final result set to React.</li>
  </ol>

  <h3>Vision Image Flow</h3>
  <pre class="architecture-diagram">
Upload Image â†’ FastAPI â†’ OpenAI Vision â†’ Tags/Flavor â†’ Vector Search â†’ Recommendations
  </pre>


  <!-- =========================== -->
  <!-- SECTION 4: Database -->
  <!-- =========================== -->

  <h2 class="section-title">4. Database Schema</h2>

  <h3>PostgreSQL Tables</h3>
  <ul class="bullet-list">
    <li><code>user_account</code> â€“ auth, email verification</li>
    <li><code>menu_item</code> â€“ title, description, price, tags</li>
    <li><code>music_track</code> â€“ title, s3_url</li>
    <li><code>orders</code> + <code>order_items</code> (future extension)</li>
  </ul>

  <h3>ChromaDB Vectors</h3>
  <p>The embedding store uses OpenAI embedding vectors for each menu item:</p>
  <pre class="architecture-diagram">
{ id, title, tags, flavor_profiles, embedding_vector[] }
  </pre>

  <!-- =========================== -->
  <!-- SECTION 5: Deployment -->
  <!-- =========================== -->

  <h2 class="section-title">5. Deployment Architecture</h2>

  <ul class="bullet-list">
    <li>ğŸ³ **Docker Compose** (FastAPI + Postgres + ChromaDB)</li>
    <li>ğŸ™ Hosted on **AWS EC2**</li>
    <li>ğŸŒ Domain: <code>yorkiebakery.com</code></li>
    <li>ğŸ§ª Staging: <code>beta.yorkiebakery.com</code></li>
    <li>ğŸ“§ AWS SES â€“ email verification & password reset</li>
    <li>ğŸª£ AWS S3 â€“ music tracks + images</li>
  </ul>

  <!-- =========================== -->
  <!-- SECTION 6: Future Plans -->
  <!-- =========================== -->

  <h2 class="section-title">6. Future Enhancements</h2>
  <ul class="bullet-list">
    <li>â­ User preference profiles (learn from history)</li>
    <li>â­ Collaborative filtering recommendations</li>
    <li>â­ Better ranking using LLM scoring + vector similarity</li>
    <li>â­ Admin analytics dashboard</li>
  </ul>

</section>

{% endblock %}